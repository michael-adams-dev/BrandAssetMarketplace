<h1 class="show-listing-heading">
  <%= @listing.title %>
</h1>

<%= link_to "All listings", listings_path %>
<% if user_signed_in? %>
  <% if current_user.seller_profile.listings.include?(@listing) %>
    <div class="listing-crud-links">
      <%= link_to "Edit listing", edit_listing_path(@listing) %>
      <%= link_to "Delete listing", @listing, method: "delete" %>
      <% if @listing.hidden %>
        <%= link_to "Unhide listing", hide_listing_path(@listing), method: :put, data: { confirm: 'This listing will become visible to buyers. Continue?' } %>
      <% else %>
        <%= link_to "Hide listing", hide_listing_path(@listing), method: :put, data: { confirm: 'This listing will not be visible to buyers. Continue?' } %>
      <% end %>
    </div>
  <% end %>
<% end %>

<% unless @listing.hidden %>
  <div class="listing-show-card">
    <%= image_tag @listing.image, class: "listing-show-img" %>
    <h3 class="listing-show-title">
        <%= @listing.title %>
    </h3>
    <p class="listing-show-desc">
      <%= @listing.description %>
    </p>
    <p class="listing-show-quantity">
      <%= @listing.quantity %>
    </p>
    <p class="listing-show-price">
      <%= @listing.price %>
    </p>

    <button data_stripe="payment"> Buy Item </button>

    <%= link_to 'Back', listings_path %>

    <script src="https://js.stripe.com/v3/"></script>
  </div>

  <% javascript_pack_tag "stripe" %>

  <div class="comment-container">
    <%= form_for [@listing, @review] do |f| %>
      <div class="comment-input">
        <%= f.label :comment %>
        <%= f.text_area :comment %>
        <%= f.submit "Submit review" %>
      </div>
    <% end %>
  </div>

  <div class="listing-reviews">
    <%= @listing.reviews.each do |review| %>
      <p><%= review.comment %> </p>
    <% end %>
  </div>
<% end %>